# Publish_web 기술 진단 보고서

**작성일:** 2025-12-25  
**대상:** `c:\Publish_web` (React + TypeScript + Vite + Keystatic + SSG)

## 0) 목적 / 범위
- “지금 시스템이 안정적으로 돌아가고, 운영/확장 시 발목 잡을 만한 부분” 위주로 점검했습니다.
- UI 미세한 스타일/문구 같은 사소한 항목은 의도적으로 제외했습니다.
- 로컬에서 빌드/런을 돌려 재현하진 않았고(정적 분석), 코드/구성/리포 구조를 기반으로 리스크를 정리했습니다.

---

## 1) 현재 구조 요약(이해한 흐름)
- **콘텐츠 소스:** `content/` 아래 Keystatic 로컬 스토리지(파일 기반)
- **런타임(브라우저/개발):** `src/utils/reader.ts`가 `import.meta.glob(...?raw)`로 콘텐츠를 로드
- **SSG(프리렌더):** `scripts/generate-static.ts`가 `src/entry-server.tsx`를 통해 라우트별 HTML 생성 + `window.__PRELOADED_DATA__` 주입
- **관리자(CMS):** `/keystatic/*` 라우트에서 Keystatic UI 제공(`src/pages/Admin.tsx`)
- **데브 API:** `vite.config.ts`의 커스텀 미들웨어로 `/api/keystatic` 처리

---

## 2) 결론(요약)
지금 프로젝트는 “정적 사이트 + 콘텐츠 파일 기반 CMS + 프리렌더”라는 방향이 명확하고 구성도 갖춰져 있습니다.
다만 아래 2가지는 **SEO/운영 품질에 직접 영향**이 있어 우선순위를 높게 잡는 게 좋습니다.

- **(P0) 프리렌더된 HTML에 SEO head(meta/title) 주입이 누락될 가능성**: `HelmetProvider` 중복/우회 import 구조 때문에 SSG 산출물에 `<title>`, `<meta>`가 기대대로 안 들어갈 수 있습니다.
- **(P0) `content_backup_*` 폴더가 Git에 추적됨**: 저장소 비대화/혼선/배포 사고(잘못된 콘텐츠 포함) 위험이 큽니다.

---

## 3) 우선순위별 개선 포인트

### P0. SSG SEO head 주입 신뢰성(HelmetProvider 중복)
**현상/리스크**
- `scripts/generate-static.ts`는 `helmetContext`를 추출해 `</head>` 앞에 주입하려고 합니다.
- 그런데 `src/entry-server.tsx`에서 `HelmetProvider(context=helmetContext)`로 감싸는 동시에, `src/App.tsx` 내부에서도 `HelmetProvider`를 또 감싸고 있습니다.
- `react-helmet-async`는 “가장 가까운 Provider”의 context를 사용하기 때문에, **내부 Provider 쪽으로 helmet 정보가 모이면 바깥 `helmetContext`는 비어** SSG 결과물에 head 태그가 누락될 수 있습니다.

**권장 수정 방향(핵심만)**
- `HelmetProvider`는 **클라이언트/서버에서 각각 1번만** 최상단에서 감싸고, `App`에서는 제거합니다.
- `react-helmet-async`는 `@ts-ignore` + `* as HelmetAsync` 우회 대신 **정식 named import**로 정리합니다.

**영향 범위**
- 검색엔진/OG 공유(카카오/페북) 미리보기 품질, 페이지별 타이틀/설명 정확도

관련 파일
- `src/App.tsx`, `src/entry-server.tsx`, `src/components/common/SEOHead.tsx`, `scripts/generate-static.ts`

---

### P0. `content_backup_*`가 Git에 포함됨(저장소/배포 리스크)
**현상/리스크**
- `content_backup_1766287415959/`가 `git ls-files` 기준으로 **추적(커밋 대상)** 상태입니다.
- 백업이 배포에 섞이거나, 사람이 잘못 수정/참조하거나, PR/리뷰가 불필요하게 커지는 문제가 생깁니다.

**권장 수정 방향**
- Git에서 해당 폴더를 **untrack** 처리하고(삭제가 아니라 추적 해제), `.gitignore`에 `content_backup_*` 패턴을 추가합니다.
- 백업이 필요하다면 `scripts/`로 “백업 생성/복구”를 표준화하고, 산출물은 Git 밖(예: 아카이브 스토리지)로 두는 편이 안전합니다.

관련 파일
- `.gitignore`, `content_backup_1766287415959/`

---

### P1. `reader` 인스턴스 캐싱(SSG 속도/안정성)
**현상/리스크**
- `src/utils/reader.ts`의 `getReader()`는 호출 때마다(특히 Node/SSG에서) `createReader(process.cwd(), keystaticConfig)`를 만들 가능성이 있습니다.
- `scripts/generate-static.ts`는 라우트 루프에서 여러 데이터를 반복 조회하므로, SSG 시간이 불필요하게 늘고, 파일 IO가 많아질 수 있습니다.

**권장 수정 방향**
- 모듈 스코프에 `let cachedReader`를 두고 최초 1회만 생성/재사용.
- 브라우저 측 `createDevReader()`도 매 호출마다 새로 만들지 말고 캐시.

관련 파일
- `src/utils/reader.ts`, `scripts/generate-static.ts`

---

### P1. Keystatic “운영 배포” 전략 정리(정적 호스팅 vs 편집 가능)
**체크 포인트**
- 현재 구성은 로컬 파일 기반(`storage.kind='local'`)에 가깝습니다.
- 운영 환경이 “정적 호스팅(S3/Cloudflare Pages 등)”이면 **서버에서 파일을 쓰는 API가 없어서** `/keystatic` 편집 기능이 동작하지 않습니다.

**권장 방향(선택지)**
- 운영에서도 웹에서 편집이 필요하면: Keystatic의 GitHub/Cloud storage 방식(또는 별도 서버)을 도입.
- 운영은 정적 제공만 하고, 편집은 내부 네트워크/로컬에서만 한다면: `/keystatic` 라우트를 운영 빌드에서 제외하거나 접근 제어(최소한 Basic Auth 등) 고려.

관련 파일
- `keystatic.config.ts`, `src/pages/Admin.tsx`, `vite.config.ts`

---

### P2. 프로젝트 메타/문서(협업 비용)
**현상**
- `package.json:name`이 아직 `temp_project`, `README.md`는 Vite 기본 템플릿입니다.

**권장 수정 방향**
- README에 최소한 아래는 들어가면 협업/인수인계가 빨라집니다.
  - `npm install`
  - `npm run dev`
  - `npm run build` + `npm run prerender` (배포 산출물/동작 방식)
  - 콘텐츠 작성 위치(`content/`)와 Keystatic 접근 경로(`/keystatic`)

관련 파일
- `package.json`, `README.md`, `scripts/generate-static.ts`

---

### P2. 하드코딩된 값(도메인/포트) 외부화
- `scripts/generate-static.ts`의 sitemap 도메인(`https://dongtl.com`)은 환경별로 달라질 수 있어 `.env` 또는 Keystatic `settings`로 이동하는 편이 안전합니다.
- `vite.config.ts`의 dev server 포트도 `.env` 기반으로 두면 충돌/공유가 편합니다.

관련 파일
- `scripts/generate-static.ts`, `vite.config.ts`, `keystatic.config.ts`

---

### P3. 불필요/레거시 컴포넌트 정리(혼선 방지)
- `src/components/common/Header.tsx`, `src/components/common/Footer.tsx` 등 레거시 스타일 기반 컴포넌트가 남아 있고, 현재 레이아웃은 `src/components/layout/*` 중심으로 보입니다.
- 실제로 사용하지 않는 컴포넌트는 정리하거나 `legacy/`로 격리해 “어떤 게 현재 경로인지”를 명확히 하면 유지보수 사고가 줄어듭니다.

---

## 4) 추천 실행 순서(빠른 안정화)
1. **P0-1:** `HelmetProvider` 단일화 + SSG head 주입 검증(프리렌더된 `dist/**/index.html`에 title/meta가 들어가는지 확인)
2. **P0-2:** `content_backup_*` untrack + ignore 처리
3. **P1:** `getReader()` 캐싱
4. **P2:** README/패키지명/환경변수 정리

---

## 5) 부록: 이번 점검에서 확인한 “좋은 점”
- `usePreloadedData()`가 `path === location.pathname` 검증을 해서, 라우트 이동 시 잘못된 preload 데이터 재사용을 막고 있음
- `reader.ts`가 YAML/MDOC 혼합과 날짜 normalize, frontmatter 실패 시 fallback을 고려하고 있음

